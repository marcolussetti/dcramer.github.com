---
wordpress_id: 117
layout: post
title: Announcing django-sphinx 2.0.0 Full-text Search
wordpress_url: http://www.davidcramer.net/?p=117
---
<p>One of my tasks lately has been updating the <a href="http://code.google.com/p/django-sphinx">django-sphinx</a> library to work with Sphinx 0.98, as it includes GIS components which we have been wanting to possibly utilize on our new search engine. So today, the conclusion of.. very few hours of work, I'd like to announce 2.0.0 of the Django integration.</p>

<p>The SphinxSearch manager has been completely rewritten to rely strictly on the Python Sphinx API (a request from the author of Sphinx), which means it should have much more compatibility with newer versions in the future. I have also updated the querysets it returns to work like normal Django QuerySet instances, to where they clone themselves so you can fork your queryset into several different actions.</p>

<p>The search results also now have a proxy which wraps each object. This proxy is specifically geared towards <a href="http://code.djangoproject.com/ticket/17">ticket #17</a>, and allows you to access a <code>_sphinx</code> attribute on each instance, without actually modifying that instance. You can also now access a <code>_sphinx</code> attribute on the queryset itself. Both of these contain relative meta-data for their object.</p>

<p>So, a quick usage example using the new API:<br><pre><br>In [1]: from sphinxtest.tests.models import *</p>

<p>In [2]: x = Document.search.query('a')</p>

<p>In [3]: x._sphinx<br>Out[3]:<br>{'total': 10,<br>'total_found': 10,<br>'words': [{'docs': 10, 'hits': 10, 'word': 'a'}]}</p>

<p>In [4]: x<br>Out[4]: [&lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;]</p>

<p>In [5]: x[0]._sphinx<br>Out[5]: {'weight': 1}</p>

<p>In [6]: x[0].title<br>Out[6]: u'Document 0'</p>

<p>In [7]: type(x)<br>Out[7]: &lt;class 'djangosphinx.SphinxSearch'&gt;</p>

<p>In [8]: type(x[0])<br>Out[8]: &lt;class 'djangosphinx.SphinxProxy'&gt;<br></pre></p>

<p>As you can see, it's full backwards compatible. Calling <code>queryset._sphinx</code> will force evaluation on the queryset. Grab the release over at <a href="http://code.google.com/p/django-sphinx">Google code</a>.</p>

<p>Comments and criticism, send em my way :)</p>