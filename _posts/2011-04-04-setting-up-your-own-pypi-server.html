---
layout: post
title: Setting Up Your Own PyPi Server
categories: ["django", "disqus", "python"]
---

<p>Ever had problems with PyPi being unreachable? Dislike dealing with requirement.txt files just to support a git repository? For a low low price of FREE, and an hour of labor, get your very own PyPi server and solve all of your worries!</p>

<h3>Set up Chishop</h3>

<p>We're going to jump right into this one. Start by setting up Chishop. Currently the best way is to do so using <a href="https://github.com/disqus/chishop">the DISQUS fork</a> as it contains several fixes. Expect to see all of the hard work in the various forks merged upstream as soon as we get some proper docs going. Follow the instructions in the README to configure Chishop, and your PyPi index.</p>

<p>Now you're going to want to tweak some things that are on by default. For starters, you're probably going to want to proxy the official PyPi repository, and this can be done by enabling a simple flag in your newly created <code>settings.py</code>:</p>

{% highlight python %}DJANGOPYPI_PROXY_MISSING = True{% endhighlight %}

<p>There are many other configuration options, but you're going to have to read the source for those.</p>

<h3>Configure PIP/Setuptools/Buildout</h3>

<p>Now that you've got a sexy PyPi server up and running, you'll probably want to configure the default index locations for your package managers. It took me a bit of Googling but then I stumpled upon an awesome post by Jacob Kaplan-Moss about <a href="http://jacobian.org/writing/when-pypi-goes-down/">dealing with PyPi when it goes down</a>, which describes procedures for configuring PyPi mirrors.</p>

<p>Let's start with <strong>pip</strong>, which stores its configuration in <code>~/.pip/pip.conf</code>:</p>

<pre>[global]
index-url = http://my.chishop/simple</pre>

<p>Next up, <strong>setuptools</strong>, located in <code>~/.pydistutils.cfg</code>:</p>

<pre>[easy_install]
index_url = http://my.chishop/simple</pre>

<p>And finally, if you use <strong>buildout</strong>, tweak your <code>buildout.cfg</code>:</p>

<pre>[buildout]
index = http://my.chishop/simple</pre>

<h3>Use It</h3>

<p>Now that you have a fully functioning PyPi, kill off your requirements files and build a real setup.py. Hopefully as a bit of inspiration, here's a snippet from Sentry's:</p>

{% highlight python %}
#!/usr/bin/env python

try:
    from setuptools import setup, find_packages
except ImportError:
    from ez_setup import use_setuptools
    use_setuptools()
    from setuptools import setup, find_packages

tests_require = [
    'django',
    'django-celery',
    'south',
    'django-haystack',
    'whoosh',
]

setup(
    name='django-sentry',
    version='1.6.8.1',
    author='David Cramer',
    author_email='dcramer@gmail.com',
    url='http://github.com/dcramer/django-sentry',
    description = 'Exception Logging to a Database in Django',
    packages=find_packages(exclude="example_project"),
    zip_safe=False,
    install_requires=[
        'django-paging>=0.2.2',
        'django-indexer==0.2.1',
        'uuid',
    ],
    dependency_links=[
        'https://github.com/disqus/django-haystack/tarball/master#egg=django-haystack',
    ],
    tests_require=tests_require,
    extras_require={'test': tests_require},
    test_suite='sentry.runtests.runtests',
    include_package_data=True,
    classifiers=[
        'Framework :: Django',
        'Intended Audience :: Developers',
        'Intended Audience :: System Administrators',
        'Operating System :: OS Independent',
        'Topic :: Software Development'
    ],
)
{% endhighlight %}
