---
wordpress_id: 65
layout: post
title: Setting up Django with Sphinx Full-text Search
wordpress_url: http://www.davidcramer.net/code/65/setting-up-django-with-sphinx.html
---
<p>It seems I suck at documentation (yes, It's very true), so here's a quick How-to on using the <a href="http://code.google.com/p/django-sphinx/">Sphinx ORM for Django</a> we created:</p>

<ol>
    <li>Download and install Sphinx (you're on your own here): <a href="http://www.sphinxsearch.com/">http://www.sphinxsearch.com/</a></li>
    <li>Download and install the Django Sphinx package: <a href="http://django-sphinx.googlecode.com/">http://django-sphinx.googlecode.com/</a> (again, on your own)</li>
    <li>Setup a source for your table:
<pre>
source files_file_en : base
{
    sql_query	= \
                     SELECT files_file.id, files_file.name, files_data.description, files_file.tags as tag \
                     FROM files_file JOIN files_data \
                     ON files_file.id = files_data.file_id \
                     AND files_data.lang = 'en' \
                     AND files_file.visible = 1 \
                     GROUP BY files_file.id
    sql_query_info	= SELECT * FROM files_file WHERE id=$id
}
</pre></li>
    <li>Setup an index for your table:
<pre>index files_file_en
{
    source			= files_file_en
    path			= /var/data/files_file_en
    docinfo			= extern
    morphology			= none
    stopwords			=
    min_word_len		= 2
    charset_type		= sbcs
    min_prefix_len		= 0
    min_infix_len		= 0
}
</pre></li>
    <li>Go into your models and add the import:
        {% highlight python %}from cursesite.core.search.models import SphinxSearch{% endhighlight %}
    </li>
    <li>Go to the model you want to attach the search to:
        {% highlight python %}search	= SphinxSearch(index="files_file_en"){% endhighlight %}
    </li>
    <li>Now query:{% highlight python %}File.search.query('hello'){% endhighlight %}</li>
</ol>
